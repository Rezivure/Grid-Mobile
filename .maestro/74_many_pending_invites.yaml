appId: app.mygrid.grid
name: "Pre-Release: Many Pending Invites"
tags: [release, stress, notifications]

# Test: API sends 8+ friend requests + 3 group invites â†’ notification handling, scrolling invite list
---

# Ensure app is running and logged in
- launchApp
- waitForAnimationToEnd
- assertVisible: "Map"

# Create many pending invites via API
- runScript:
    script: |
      cd .maestro/helpers
      
      # Login many users for friend requests
      for i in {2..10}; do
        ./api_login.sh testuser$i testpass123 &
      done
      wait
      
      # Send many friend requests
      ./api_send_friend_request.sh testuser2 testuser1 &
      ./api_send_friend_request.sh testuser3 testuser1 &
      ./api_send_friend_request.sh testuser4 testuser1 &
      ./api_send_friend_request.sh testuser5 testuser1 &
      ./api_send_friend_request.sh testuser6 testuser1 &
      ./api_send_friend_request.sh testuser7 testuser1 &
      ./api_send_friend_request.sh testuser8 testuser1 &
      ./api_send_friend_request.sh testuser9 testuser1 &
      wait
      
      # Create multiple groups and invite user1
      ./api_create_group.sh testuser2 "InviteGroup1" 3600 &
      ./api_create_group.sh testuser3 "InviteGroup2" 3600 &
      ./api_create_group.sh testuser4 "InviteGroup3" 3600 &
      wait
      
      # Invite user1 to all groups (this simulates pending group invites)
      ./api_join_room.sh testuser1 "InviteGroup1" &
      ./api_join_room.sh testuser1 "InviteGroup2" &
      ./api_join_room.sh testuser1 "InviteGroup3" &
      wait
    timeout: 30000

# Wait for all invites to sync
- waitForAnimationToEnd:
    timeout: 15000

# Check notification bell - should show many pending invites
- tapOn: "Notifications"
- waitForAnimationToEnd:
    timeout: 5000

# Verify we can see multiple friend requests
- assertVisible: "testuser2"
- assertVisible: "testuser3"
- assertVisible: "testuser4"

# Scroll down through invite list to see more
- scrollUntilVisible:
    element: "testuser6"
    direction: DOWN
    
- scrollUntilVisible:
    element: "testuser8"
    direction: DOWN

# Verify group invites are also visible
- scrollUntilVisible:
    element: "InviteGroup1"
    direction: DOWN

- scrollUntilVisible:
    element: "InviteGroup2" 
    direction: DOWN

# Test accepting one friend request
- tapOn: "Accept"
- waitForAnimationToEnd

# Test declining one friend request
- scrollUntilVisible:
    element: "testuser3"
    direction: UP

- tapOn:
    text: "Decline"
    optional: true
- waitForAnimationToEnd

# Verify we can still scroll and interact with remaining invites
- scrollUntilVisible:
    element: "testuser5"
    direction: DOWN

# Go back to map
- tapOn: "Back"
- assertVisible: "Map"

# Verify notification handling didn't break the app
- tapOn: "Settings"
- assertVisible: "Display Name"
- tapOn: "Back"
- assertVisible: "Map"