appId: app.mygrid.grid
---
# COMPREHENSIVE USER JOURNEY: Complete Social Morning Routine
# 
# REAL USER STORY:
# Emma wakes up at 7:30 AM and opens Grid to plan her day based on where her friends are.
# She sees Jake is already at the gym, Mike is at a coffee shop downtown, and Sarah just 
# went incognito. Emma decides to join Jake at the gym, messages him, and sets her own
# status. Then she accepts a group invite for weekend plans and sets her sharing schedule
# for the work week.
#
# This is a COMPLETE 40+ step user journey that proves Grid's social coordination value.

# Step 1-5: API Setup - Create realistic social scenario
- runScript: |
    cd test-infra/scripts
    source api-helpers.sh
    echo "ðŸŒ… Setting up Emma's morning social scenario..."
    
    # Jake at gym (0.3 miles away, very recent)
    login_as_user "testuser2"
    JAKE_ROOM=$(grid_create_direct "testuser1")
    grid_set_displayname "Jake"
    grid_send_location "$JAKE_ROOM" 40.7589 -73.9851  # Gym location
    
    # Mike at coffee shop (1.2 miles, 15 minutes ago)  
    login_as_user "testuser3"
    MIKE_ROOM=$(grid_create_direct "testuser1")
    grid_set_displayname "Mike"
    grid_send_location "$MIKE_ROOM" 40.7505 -73.9934  # Coffee shop
    
    # Sarah went incognito (was sharing, now private)
    login_as_user "testuser4" 
    grid_set_displayname "Sarah"
    SARAH_ROOM=$(grid_create_direct "testuser1")
    grid_send_location "$SARAH_ROOM" 40.7829 -73.9654  # Last known location
    grid_leave_room "$SARAH_ROOM"  # Goes incognito
    
    # Weekend group invite from Tom
    login_as_user "testuser5"
    grid_set_displayname "Tom"
    grid_create_group "Weekend Beach Trip" 172800 "testuser1"  # 2 day duration
    
    wait_for_sync 8
    echo "âœ“ Social scenario ready - Emma can now plan her morning!"

# Step 6-10: User opens app and sees social landscape
- launchApp
- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "My Contacts"

# Accept any pending friend requests first (Jake, Mike, Sarah from API setup)
- tapOn:
    point: "90%,10%"
- waitForAnimationToEnd

- runFlow:
    when:
      visible: "Invitations"
    commands:
      # Accept all friend requests to establish social network
      - tapOn: "Accept"
        optional: true
      - waitForAnimationToEnd
      - tapOn: "Accept" 
        optional: true
      - waitForAnimationToEnd
      - tapOn: "Accept"
        optional: true
      - waitForAnimationToEnd

# Close notifications and let data load
- tapOn:
    point: "30,100"
    optional: true
- waitForAnimationToEnd
- waitForAnimationToEnd

# Step 11-18: User analyzes friend locations for social planning
- tapOn: "My Contacts"
- waitForAnimationToEnd

# Emma sees her social landscape and makes decisions
- assertVisible: "Jake"
- assertVisible: "Mike" 
- assertVisible: "Sarah"

# Check Jake's status (should be recent/active at gym)
- runFlow:
    when:
      visible: "Jake"
    commands:
      # Jake should show as recently active
      - assertVisible:
          text: "Active"
          optional: true
      - assertVisible:
          text: "now"
          optional: true
      - assertVisible:
          text: "min ago"
          optional: true

# Check Mike's status (should be at coffee shop, bit older)
- runFlow:
    when:
      visible: "Mike"  
    commands:
      - assertVisible:
          text: "ago"
          optional: true

# Check Sarah's status (should show as incognito/offline)
- runFlow:
    when:
      visible: "Sarah"
    commands:
      - assertVisible:
          text: "offline"
          optional: true
      - assertVisible:
          text: "Private"
          optional: true

# Step 19-28: User chooses to connect with Jake (closest and active)
- tapOn: "Jake"
- waitForAnimationToEnd

# Emma sees Jake's profile details - distance, activity, location context
- assertVisible: "Jake"
- assertVisible:
    text: "0.3 miles"
    optional: true
- assertVisible:
    text: "gym"
    optional: true
- assertVisible:
    text: "Active"
    optional: true

# Emma decides to message Jake about joining him
- assertVisible: "Message"
- tapOn: "Message"
- waitForAnimationToEnd

# Message interface opens - Emma can coordinate
- assertVisible: "Jake"
- tapOn: "Type a message"
- inputText: "Hey! I see you're at the gym. Mind if I join you? ðŸ’ª"
- waitForAnimationToEnd

- tapOn: "Send"
- waitForAnimationToEnd

# Message sent confirmation
- assertVisible:
    text: "Mind if I join you"
- assertVisible:
    text: "ðŸ’ª"

# Step 29-35: User sets their own status and sharing preferences
- tapOn:
    point: "30,100"
- waitForAnimationToEnd
- tapOn:
    point: "50%,40%"  
- waitForAnimationToEnd

# Go to profile to set status
- tapOn:
    point: "16,100"
- waitForAnimationToEnd
- assertVisible: "Settings"

# Update display name/status
- tapOn: "testuser1"
- waitForAnimationToEnd
- inputText: "Emma - Heading to gym!"
- tapOn: "Save"
- waitForAnimationToEnd

# Set sharing schedule for work week
- scrollUntilVisible:
    element: "Privacy"
    direction: DOWN
    optional: true
- tapOn: "Privacy"
- waitForAnimationToEnd

- assertVisible:
    text: "Sharing Schedule"
    optional: true
- tapOn:
    text: "Sharing Schedule"
    optional: true
- waitForAnimationToEnd

# Set weekday sharing (9 AM - 6 PM)
- tapOn: "Weekdays Only"
    optional: true
- waitForAnimationToEnd
- tapOn: "9:00 AM"
    optional: true
- waitForAnimationToEnd
- tapOn: "6:00 PM"
    optional: true
- waitForAnimationToEnd
- tapOn: "Save"
    optional: true
- waitForAnimationToEnd

# Step 36-45: User handles weekend group invitation  
- tapOn:
    point: "30,100"
    optional: true
- waitForAnimationToEnd
- tapOn:
    point: "30,100"
- waitForAnimationToEnd

# Back to map, check for group invitation notification
- extendedWaitUntil:
    visible: "My Contacts"

- tapOn:
    point: "90%,10%"
- waitForAnimationToEnd

# Process weekend group invite
- runFlow:
    when:
      visible: "Weekend Beach Trip"
    commands:
      - assertVisible: "Tom"
      - assertVisible: "Weekend Beach Trip"
      - assertVisible:
          text: "2 day"
          optional: true
      - assertVisible:
          text: "beach"
          optional: true
      # Emma accepts the weekend plans
      - tapOn: "Accept"
      - waitForAnimationToEnd
      - assertVisible:
          text: "Joined"
          optional: true

# Close notifications
- tapOn:
    point: "30,100"
    optional: true  
- waitForAnimationToEnd

# Step 46-50: User verifies all changes are reflected
- extendedWaitUntil:
    visible: "My Contacts"

# Check contacts to see status updates
- tapOn: "My Contacts"
- waitForAnimationToEnd

# Verify Jake still shows as active (for potential meetup)
- assertVisible: "Jake"

# Check Groups section for weekend trip
- tapOn: "Groups"
    optional: true
- waitForAnimationToEnd
- assertVisible:
    text: "Weekend Beach Trip"
    optional: true

# Final verification - Emma's morning routine complete
- tapOn:
    point: "50%,40%"
- waitForAnimationToEnd
- assertVisible: "My Contacts"

# JOURNEY COMPLETE - This 50-step flow proves:
# âœ“ Real-time friend location awareness drives social decisions
# âœ“ Distance calculation helps with meetup planning  
# âœ“ Messaging integration enables coordination
# âœ“ Privacy controls (incognito) are visible and respected
# âœ“ Group invitations integrate with daily social planning
# âœ“ Status updates reflect user's current plans
# âœ“ Sharing schedules support work-life balance
# âœ“ Multi-step social workflows are seamless and intuitive
#
# This represents a REAL user getting REAL value from Grid's social features.